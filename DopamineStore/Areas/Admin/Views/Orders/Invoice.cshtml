@model Order
@using System.Globalization
@using System.Text
@{
    Layout = null;
    var arabicCulture = new CultureInfo("ar-EG");
}
@functions {
    public static string ToArabicNumerals(string input)
    {
        if (string.IsNullOrEmpty(input)) return "";
        return new StringBuilder(input)
            .Replace('0', '٠')
            .Replace('1', '١')
            .Replace('2', '٢')
            .Replace('3', '٣')
            .Replace('4', '٤')
            .Replace('5', '٥')
            .Replace('6', '٦')
            .Replace('7', '٧')
            .Replace('8', '٨')
            .Replace('9', '٩').ToString();
    }
}

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>فاتورة الطلب #@ToArabicNumerals(Model.Id.ToString())</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&family=Hayah&display=swap" rel="stylesheet">
    <link href="~/css/admin-invoice.css" rel="stylesheet" asp-append-version="true" />
</head>
<body>
    <div class="invoice-container">
        <div class="invoice-actions">
            <button onclick="window.print()" class="btn btn-primary"><i class="fas fa-print me-2"></i>طباعة</button>
            <button onclick="window.close()" class="btn btn-secondary">إغلاق</button>
        </div>
        <div class="invoice-paper">
            <div class="watermark">
                <img src="~/img/logo.png" alt="Watermark" />
            </div>
            <header class="invoice-header">
                <div class="invoice-brand">
                    <img src="~/img/logo.png" alt="Dopamine Logo" class="logo-img" />
                    <div>
                        <h1 class="brand-name">دوبامين</h1>
                        <p class="brand-slogan">متجرك للإبداع</p>
                    </div>
                </div>
                <div class="invoice-title">
                    <h2>فاتورة</h2>
                    <div class="invoice-meta">
                        <div class="meta-item"><span>#</span> @ToArabicNumerals(Model.Id.ToString())</div>
                        <div class="meta-item"><span>التاريخ:</span> @ToArabicNumerals(Model.OrderDate.ToString("dd/MM/yyyy"))</div>
                    </div>
                </div>
            </header>

            <section class="invoice-parties">
                <div class="party-box">
                    <h6>فاتورة من:</h6>
                    <p>
                        <strong>دوبامين</strong><br>
                        المروه, بورسعيد, مصر<br>
                        dopaminesalmaatef@gmail.com
                    </p>
                </div>
                <div class="party-box">
                    <h6>فاتورة إلى:</h6>
                    <p>
                        <strong>@Model.CustomerName</strong><br>
                        @Model.ShippingAddress, @Model.City<br>
                        @Model.CustomerEmail
                    </p>
                </div>
            </section>

            <section class="invoice-items">
                <table class="table">
                    <thead>
                        <tr>
                            <th>المنتج</th>
                            <th class="text-center">سعر الوحدة</th>
                            <th class="text-center">الكمية</th>
                            <th class="text-end">الإجمالي</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var detail in Model.OrderDetails)
                        {
                            <tr>
                                <td>
                                    <div class="product-name">@(detail.Product?.Name ?? "منتج محذوف")</div>
                                </td>
                                <td class="text-center">@ToArabicNumerals(detail.UnitPrice.ToString("C", arabicCulture))</td>
                                <td class="text-center">@ToArabicNumerals(detail.Quantity.ToString("N0"))</td>
                                <td class="text-end">@ToArabicNumerals(((detail.Quantity * detail.UnitPrice).ToString("C", arabicCulture)))</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </section>

            <section class="invoice-summary">
                <div class="invoice-payment-info">
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=https://your-website-url.com" alt="QR Code" class="qr-code" />
                    <p class="qr-note">امسح لزيارة موقعنا</p>
                </div>
                <div class="invoice-totals">
                    <div class="totals-item">
                        <span class="label">الإجمالي الفرعي:</span>
                        <span class="value">@ToArabicNumerals(Model.OrderDetails.Sum(d => d.Quantity * d.UnitPrice).ToString("C", arabicCulture))</span>
                    </div>
                    <div class="totals-item">
                        <span class="label">مصاريف الشحن:</span>
                        <span class="value">@ToArabicNumerals(((Model.TotalAmount - Model.OrderDetails.Sum(d => d.Quantity * d.UnitPrice)).ToString("C", arabicCulture)))</span>
                    </div>
                    <div class="totals-item grand-total">
                        <span class="label">الإجمالي النهائي:</span>
                        <span class="value">@ToArabicNumerals(Model.TotalAmount.ToString("C", arabicCulture))</span>
                    </div>
                </div>
            </section>

            <footer class="invoice-footer">
                <p>شكراً لتعاملكم معنا!</p>
            </footer>
        </div>
    </div>
</body>
</html>
